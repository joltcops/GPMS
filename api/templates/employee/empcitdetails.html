<html>
    <head>
        <title>Citizen Details</title>
    </head>
    <body>
        <h1>Citizen Details</h1>

<div class="container">

  <!-- Personal Information -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2>Personal Information</h2>
      <a href="{% url 'citizen_edit' citizen.citizen_id %}" class="btn btn-warning">Edit</a>
    </div>
    <div class="card-body">
      <dl class="row">
        <dt class="col-sm-3">ID</dt>
        <dd class="col-sm-9">{{ citizen.citizen_id }}</dd>
        <dt class="col-sm-3">Name</dt>
        <dd class="col-sm-9">{{ citizen.name }}</dd>
        <dt class="col-sm-3">Gender</dt>
        <dd class="col-sm-9">{{ citizen.gender }}</dd>
        <dt class="col-sm-3">Date of Birth</dt>
        <dd class="col-sm-9">{{ citizen.dob }}</dd>
        <dt class="col-sm-3">Educational Qualification</dt>
        <dd class="col-sm-9">{{ citizen.educational_qualification }}</dd>
        <dt class="col-sm-3">Parent</dt>
        <dd class="col-sm-9">{{ citizen.parent_id }}</dd>
        <dt class="col-sm-3">Income</dt>
        <dd class="col-sm-9">{{ citizen.income }}</dd>
      </dl>
    </div>
  </div>

  <!--User info-->

  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2>User Information</h2>
      <a href="{% url 'user_edit' user.user_id %}" class="btn btn-warning">Edit</a>
    </div>
    <div class="card-body">
      <dl class="row">
        <dt class="col-sm-3">UserID</dt>
        <dd class="col-sm-9">{{ user.user_id }}</dd>
        <dt class="col-sm-3">Password</dt>
        <dd class="col-sm-9">{{ user.password_user }}</dd>
      </dl>
    </div>

  <!-- Household Information -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2>Household Details</h2>
      <a href="{% url 'household_edit' household.household_id %}" class="btn btn-warning">Edit</a>
    </div>
    <div class="card-body">
      <dl class="row">
        <dt class="col-sm-3">Address</dt>
        <dd class="col-sm-9">{{ household.address }}</dd>
        <dt class="col-sm-3">Category</dt>
        <dd class="col-sm-9">{{ household.category }}</dd>
        <dt class="col-sm-3">Household income</dt>
        <dd class="col-sm-9">{{ household.income }}</dd>
        <dt class="col-sm-3">Household members</dt>
        <dd class="col-sm-9">
          <ul>
            {% for member in members %}
            <li>{{ member.citizen_id }} ({{ member.name }})</li>
            {% endfor %}
          </ul>
        </dd>

      </dl>
    </div>
  </div>

  <!-- Land Records -->
  <div class="card mb-4">
    <div class="card-header">
      <h2>Land Holdings</h2>
      <a href="{% url 'add_land' citizen.citizen_id%}">Add</a>
    </div>
    <div class="card-body">
      {% for plot in land %}
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          {{ plot.crop_type }} ({{ plot.area_acres }} acres)
        </div>
        <a href="{% url 'land_edit' plot.land_id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
        <button onclick="confirmDelete('land', '{{ plot.land_id }}')" 
            class="btn btn-sm btn-danger">Delete</button>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Scheme enrollments -->
  <div class = "card mb-4">
    <div class="card-header">
      <h2>Scheme Enrollments</h2>
    </div>
    <div class="card-body">
      <ul>
        {% for scheme in senroll %}
        <li>Enrollment Id: {{ scheme.enrollment_id }} Scheme: {{ scheme.scheme_id }} Enrollment Date: {{ scheme.enrollment_date }}</li>
        {% endfor %}
      </ul>
    </div>

    <div class = "card mb-4">
      <div class="card-header">
        <h2>Vaccinations</h2>
        <a href="{% url 'add_vaccine' citizen.citizen_id%}">Add</a>
      </div>
      <div class="card-body">
        <ul>
          {% for vac in vaccinations %}
          <li>Vaccination ID: {{ vac.vaccination_id }} Type: {{ vac.vaccine_type }} Date Administered: {{ vac.date_administered }}
            <button onclick="console.log('Clicked'); confirmDelete('vaccine', '{{ vac.vaccination_id }}');" 
            class="btn btn-sm btn-danger">Delete</button>
         </li>
          {% endfor %}
        </ul>
      </div>

    </div>

</div>

<!--Tax details-->

<div class="card mb-4">
  <div class="card-header">
    <h2>Tax Details</h2>
    <a href="{% url 'add_tax' citizen.citizen_id %}">Add</a>
  </div>
  <div class="card-body">
    <ul>
      {% for tax in taxes %}
      <li>Tax ID: {{ tax.0 }} Type: {{ tax.2 }} Amount: {{ tax.3 }} Date: {{ tax.4 }} Status: {{ tax.5 }}
        </li>
        {% endfor %}
    </ul>
    </div>
    </div>

</body>
</html>

<!--Tax details-->

<div class="card mb-4">
  <div class="card-header">
    <h2>Tax Details</h2>
    <a href="{% url 'add_tax' citizen.citizen_id %}">Add</a>
  </div>
  <div class="card-body">
    <ul>
      {% for tax in taxes %}
      <li>Tax ID: {{ tax.0 }} Type: {{ tax.2 }} Amount: {{ tax.3 }} Date: {{ tax.4 }} Status: {{ tax.5 }}
        </li>
        {% endfor %}
    </ul>
    </div>
    </div>

</body>
</html>


<script>
    function confirmDelete(type, id) {
        console.log(`Deleting ${type} ${id}`);
      if (confirm(`Are you sure you want to delete this ${type} record?`)) {
        console.log(`Deleting ${type} ${id}`);
        deleteRecord(type, id);
      }
    }
    
    async function deleteRecord(type, id) {
      try {
        const response = await fetch(`/api/delete-${type}/${id}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          document.getElementById(`${type}-${id}`).remove();
        } else {
          alert('Failed to delete record');
        }
      } catch (error) {
        console.error('Error:', error);
        // alert('An error occurred while deleting');
      }
    }
    </script>